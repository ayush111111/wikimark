<!DOCTYPE html>
<html>
<head>
    <title>WikiMark - Real-Time Search</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>WikiMark - Real-Time Search (WebSocket)</h1>
        <p><a href="/static/index.html">Back to Normal Search</a></p>
        
        <input type="text" id="search-query" placeholder="Enter search term">
        <button onclick="search()">Search (Real-Time)</button>
        
        <div id="status"></div>
        <div id="results"></div>
    </div>

    <script>
        let ws = new WebSocket(`ws://${window.location.host}/ws/search`);
        
        ws.onopen = () => {
            document.getElementById('status').textContent = 'Connected';
        };
        
        ws.onclose = () => {
            document.getElementById('status').textContent = 'Disconnected';
        };
        
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            if (data.type === 'search_started') {
                document.getElementById('results').innerHTML = '<h3>Searching...</h3>';
            }
            else if (data.type === 'result') {
                const div = document.createElement('div');
                div.className = 'article';
                div.innerHTML = `
                    <h4>${data.data.title}</h4>
                    <p>${data.data.summary ? data.data.summary.substring(0, 200) + '...' : 'No summary'}</p>
                `;
                document.getElementById('results').appendChild(div);
            }
            else if (data.type === 'search_complete') {
                document.getElementById('status').textContent = ` Found ${data.total} articles`;
            }
        };
        
        function search() {
            const query = document.getElementById('search-query').value;
            ws.send(JSON.stringify({query: query}));
        }
    </script>
</body>
</html>